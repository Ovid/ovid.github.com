

<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Facebook -->

  <meta property="fb:app_id" content="329861788447703" />
  
  
  <meta property="og:image" content="https://ovid.github.io/static/images/facebook/code.jpg" />
  <meta property="og:image:type" content="image/jpeg" />
  <meta property="og:image:alt" content="A laptop computer with Ruby on Rails code displayed on the monitor. Source: https://www.pexels.com/photo/black-and-gray-laptop-computer-546819/" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="https://ovid.github.io/articles/introducing-moosexextended-for-perl.html" />
  
  <meta property="og:title" content="Introducing MooseX::Extended for Perl" />
  <meta property="og:description" content="MooseX::Extended provides safe defaults, best practices, and useful features for Moose." />

  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-129723079-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-129723079-1');
  </script>


  <!-- Basic Page Needs -->
  <meta charset="utf-8">
  <title>Introducing MooseX::Extended for Perl</title>
  <meta name="description" content="Introducing MooseX::Extended for Perl">
  <meta name="author" content="Curtis Poe">
  <link rel="alternate" type="application/rss+xml" title="Subscribe to my technical blog" href="https://ovid.github.io/article.rss" />
  <link rel="alternate" type="application/rss+xml" title="Subscribe to my personal blog" href="https://ovid.github.io/blog.rss" />

  <!-- Mobile Specific Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS -->
  <link rel="stylesheet" href="/static/css/normalize.css">
  <link rel="stylesheet" href="/static/css/skeleton.css">
  <link rel="stylesheet" href="/static/css/main.css">
  <link rel="stylesheet" href="/static/css/dialog.css">
  <link rel="stylesheet" href="/css/layout.css">
    <link rel="stylesheet" type="text/css" href="/static/css/prism.css"/> 
    

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="images/favicon.png">

</head>
<body>

  <!-- Primary Page Layout -->
  <div class="container">
    <div class="row books">
        <div class="twelve columns header">
			<ul>
			<li><a
            href="https://www.amazon.com/Perl-Hacks-Programming-Debugging-Surviving/dp/0596526741/"
            target="_blank"><img src="/static/images/perl-hacks.jpg"
            alt="The cover of the 'Perl Hacks' book" class="book"></a></li>
			<li><a
            href="https://www.amazon.com/Beginning-Perl-Curtis-Poe/dp/1118013840/"
            target="_blank"><img src="/static/images/beginning-perl.jpg"
            alt="The cover of the 'Beginning Perl' book" class="book"></a></li>
			<li><img class="book" src="/static/images/profile.png" alt="An
            image of Curtis Poe, holding some electronic equipment in front of
            his face."></li>
			</ul>
        </div>
    </div>
    <div class="row title">
        <!-- Back to top button -->
        <span aria-hidden="true"><a href="#top" class="arrow"><button id="scrollToTopButton">↑</button></a></span>
        <h1><a name="-title-no-title-found-"></a>Introducing MooseX::Extended for Perl</h1>
        <time>2022-05-26</time>
        <hr>
        <div class="twelve columns header">
        </div>
    </div>
    <div class="row">
      
      <div class="three columns">
        <ul>
          <li><a href="/index.html">Home</a></li>
          <li><a href="/articles.html">Technical Articles</a> <a href="/article.rss"><img border="0" alt="Subscribe to Articles by Ovid" src="/static/images/rss.png" width="12" height="12"/></a></li>
          <li><a href="/blog.html">Blog</a> <a href="/blog.rss"><img border="0" alt="Subscribe to Blogs by Ovid" src="/static/images/rss.png" width="12" height="12"/></a></li>
          <li><a href="/hireme.html">Hire Me</a></li>
          <li><a href="/publicspeaking.html">Public Speaking</a></li>
          <li><a href="/wildagile.html">WildAgile</a></li>
          <li><a href="/tau-station.html">Tau Station</a></li>
          <li><a href="/starmap.html">Starmap</a></li>
        </ul>
        <hr>
        <strong>Find me on ...</strong>
        <ul>
          <li><a href="https://twitter.com/OvidPerl">Twitter</a></li>
          <li><a href="https://github.com/Ovid/">GitHub</a></li>
          <li><a href="https://www.linkedin.com/in/curtispoe/">LinkedIn</a></li>
        </ul>
        <hr>
        <strong>Tags</strong>
        <ul class="cloud" role="navigation" aria-label="Tag cloud for Ovid's site">
        
            
            
            <li><a href="/tags/business.html" data-weight="9">Business</a></li>
        
            
            
            <li><a href="/tags/corinna.html" data-weight="7">Corinna</a></li>
        
            
            
            <li><a href="/tags/databases.html" data-weight="8">Databases</a></li>
        
            
            
            <li><a href="/tags/family.html" data-weight="4">Family</a></li>
        
            
            
            <li><a href="/tags/math.html" data-weight="4">Math</a></li>
        
            
            
            <li><a href="/tags/oop.html" data-weight="9">OOP</a></li>
        
            
            
            <li><a href="/tags/perl.html" data-weight="8">Perl</a></li>
        
            
            
            <li><a href="/tags/personal.html" data-weight="3">Personal</a></li>
        
            
            
            <li><a href="/tags/politics.html" data-weight="5">Politics</a></li>
        
            
            
            <li><a href="/tags/programming.html" data-weight="9">Programming</a></li>
        
            
            
            <li><a href="/tags/space.html" data-weight="3">Space</a></li>
        
            
            
            <li><a href="/tags/writing.html" data-weight="7">Writing</a></li>
        
        </ul>
      </div>

        <div class="nine columns verticalLine article">

        <div class="prevNext">
        
        <a href="/articles/common-problems-in-object-oriented-code.html" class="prevPost">&laquo; Common Problems in Object-Oriented Code</a>
        
        <a href="/#" class="nextPost"></a>
    </div>

    

<ul class="inline" role="navigation" aria-label="Tag list for this articles">
    <li>Tags:</li>

    <li><a href="/tags/corinna.html">Corinna</a> </li>

    <li><a href="/tags/oop.html">OOP</a> </li>

    <li><a href="/tags/perl.html">Perl</a> </li>

    <li><a href="/tags/programming.html">Programming</a> </li>

</ul>


        <hr>
    <blockquote> We're hiring experienced Perl developers for full-time
<em>remote</em> contracts on a number of projects. If you are interested, <a
href="mailto:curtis.poe@gmail.com">email me</a>. We also have one potential
role for an experienced Python developer with OpenAPI + ORM experience.
</blockquote> 

<hr/>



<p><nav role="navigation" class="table-of-contents">
    <ul>
    <li class="indent-1"><a href="#introduction">Introduction</a></li>
    <li class="indent-1"><a href="#less-boilerplate">Less Boilerplate</a></li>
    <li class="indent-1"><a href="#param-and-field">param and field</a></li>
    <li class="indent-1"><a href="#attribute-shortcuts">Attribute Shortcuts</a></li>
    <li class="indent-1"><a href="#cloning">Cloning</a></li>
    <li class="indent-1"><a href="#customization">Customization</a></li>
    <li class="indent-1"><a href="#conclusion">Conclusion</a></li>
    </ul>
</nav>
<hr></p>

<h1><a name="introduction"></a>Introduction</h1>

<p>If you’re waiting for <a href="https://github.com/Ovid/Cor" target="_blank">the Corinna OOP project</a> <span class="fa fa-external-link fa_custom"></span> to 
land in the Perl core, you’ll have to wait. <a href="http://leonerds-code.blogspot.com/" target="_blank">Paul 
Evans</a> <span class="fa fa-external-link fa_custom"></span> will start working on the 
implementation after Perl version 5.36 is released. However, it’s a lot of work 
and it’s not clear that if it will be ready by 5.38 and even then, it will be 
experimental. You’ve a couple of years to wait.</p>

<p>To bridge the gap, I’ve released 
<a href="https://metacpan.org/pod/MooseX::Extended" target="_blank">MooseX::Extended</a> <span class="fa fa-external-link fa_custom"></span>. It’s not really 
“Corinna-lite” because the way <a href="https://metacpan.org/pod/Moose" target="_blank">Moose</a> <span class="fa fa-external-link fa_custom"></span> works and 
the way Corinna works aren’t quite compatible, but it will make your Moose code 
easier to write.</p>

<h1><a name="less-boilerplate"></a>Less Boilerplate</h1>

<p>The bane of many programmer’s existence is boilerplate. We hate boilerplate. Not 
only do we have to <em>type</em> the boilerplate, but we also have to remember it. For 
a simple, “read only” 2D point class in Moose, the class and my boilerplate 
looks something like this:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">package My::Point::Moose;

use v5.20.0;
use Moose;
use MooseX::StrictConstructor;

use Types::Standard qw(Num);
use feature qw( signatures postderef postderef_qq );
no warnings qw( experimental::signatures experimental::postderef );
use namespace::autoclean;
use mro 'c3';

has [ 'x', 'y' ] =&gt; ( is =&gt; 'ro', isa =&gt; Num );

__PACKAGE__-&gt;meta-&gt;make_immutable;

1;
</code></pre></div>

<p>That’s a lot of boilerplate. Some of it’s not needed for this module, so I am 
often lazy and don’t write the boilerplate I don’t need, meaning I have to go 
back and add it later as the class grows.</p>

<p>Here’s the same code with <code>MooseX::Extended</code>:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">package My::Point;
use MooseX::Extended types =&gt; [qw/Num/];

param [ 'x', 'y' ] =&gt; ( isa =&gt; Num );
</code></pre></div>

<p>That’s right, you don’t have to declare it immutable or end it with a true 
value. <code>MooseX::Extended</code> handles that for you (though you can disable this).</p>

<p>Hmm, what if I want to subclass that and make it mutable?</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">package My::Point::Mutable::Moose;
use v5.20.0;
use Moose;
extends 'My::Point::Moose';
use MooseX::StrictConstructor;
use feature qw( signatures postderef postderef_qq );
no warnings qw( experimental::signatures experimental::postderef );
use namespace::autoclean;
use mro 'c3';

has '+x' =&gt; (
    is      =&gt; 'ro',
    writer  =&gt; 'set_x',
    clearer =&gt; 'clear_x',
    default =&gt; 0,
);

has '+y' =&gt; (
    is      =&gt; 'ro',
    writer  =&gt; 'set_y',
    clearer =&gt; 'clear_y',
    default =&gt; 0,
);

sub invert ($self) {
    my ( $x, $y ) = ( $self-&gt;x, $self-&gt;y );
    $self-&gt;set_x($y);
    $self-&gt;set_y($x);
}

__PACKAGE__-&gt;meta-&gt;make_immutable;
1;
</code></pre></div>

<p>Here it is in <code>MooseX::Extended</code>:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">package My::Point::Mutable;
use MooseX::Extended;
extends 'My::Point';

param [ '+x', '+y' ] =&gt; ( writer =&gt; 1, clearer =&gt; 1, default =&gt; 0 );

sub invert ($self) {
    my ( $x, $y ) = ( $self-&gt;x, $self-&gt;y );
    $self-&gt;set_x($y);
    $self-&gt;set_y($x);
}
</code></pre></div>

<p>Again, it lets me focus on writing code that <em>works</em>, rather than all the 
scaffolding that’s usually needed.</p>

<p>Note: we also provide 
<a href="https://metacpan.org/pod/MooseX::Extended::Role" target="_blank">MooseX::Extended::Role</a> <span class="fa fa-external-link fa_custom"></span> which 
behaves similarly.</p>

<h1><a name="param-and-field"></a>param and field</h1>

<p>You can still use the <code>has</code> function to declare your Moose attributes, but I
recommend using <code>param</code> and <code>field</code> instead. Why? We’ve regularly face the 
following problem:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">package Some::Class;

use Moose;

has name     =&gt; (...);
has uuid     =&gt; (...);
has id       =&gt; (...);
has backlog  =&gt; (...);
has auth     =&gt; (...);
has username =&gt; (...);
has password =&gt; (...);
has cache    =&gt; (...);
has this     =&gt; (...);
has that     =&gt; (...);
</code></pre></div>

<p>Which of those should be passed to the constructor and which should not? Just
because you <em>can</em> pass something to the constructor doesn’t mean you
<em>should</em>. Unfortunately, Moose defaults to “opt-out” rather than “opt-in” for
constructor arguments. This makes it really easy to build objects, but means
that you can pass unexpected things to the constructor and it won’t always work 
the way you want it to.</p>

<p>There’s an arcane <code>init_arg =&gt; undef</code> pair to pass to each to say “this
cannot be set via the constructor,” but many developers are either unaware of
this is simply forget about it. <code>MooseX::Extended</code> solves with by separating
<code>has</code> into <code>param</code> (allowed in the constructor, but you can also use
<code>default</code> or <code>builder</code>) and <code>field</code>, which is forbidden in the constructor.</p>

<p>We can rewrite the above as this:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">package Some::Class;

use MooseX::Extended;

param name     =&gt; (...);
param backlog  =&gt; (...);
param auth     =&gt; (...);
param username =&gt; (...);
param password =&gt; (...);

field cache    =&gt; (...);
field this     =&gt; (...);
field that     =&gt; (...);
field uuid     =&gt; (...);
field id       =&gt; (...);
</code></pre></div>

<p>And now you can instantly see what is and is not <em>intended</em> to be allowed in
the constructor.</p>

<p>There’s a lot more I can say about that, but you can read <a href="https://metacpan.org/pod/MooseX::Extended#MANUAL" target="_blank">the 
manual</a> <span class="fa fa-external-link fa_custom"></span> for more information.</p>

<h1><a name="attribute-shortcuts"></a>Attribute Shortcuts</h1>

<p>When using <code>field</code> or <code>param</code>, we have some attribute shortcuts:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">param name =&gt; (
    isa       =&gt; NonEmptyStr,
    writer    =&gt; 1,   # set_name
    reader    =&gt; 1,   # get_name
    predicate =&gt; 1,   # has_name
    clearer   =&gt; 1,   # clear_name
    builder   =&gt; 1,   # _build_name
);

sub _build_name ($self) {
    ...
}
</code></pre></div>

<p>These can also be used when you pass an array reference to the function:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">package Point {
    use MooseX::Extended types =&gt; ['Int'];

    param [ 'x', 'y' ] =&gt; (
        isa     =&gt; Int,
        clearer =&gt; 1,     # clear_x and clear_y available
        default =&gt; 0,
    );
}
</code></pre></div>

<p>Note that these are <em>shortcuts</em> and they make attributes easier to write and more consistent.
However, you can still use full names:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">field authz_delegate =&gt; (
    builder =&gt; '_build_my_darned_authz_delegate',
);
</code></pre></div>

<h1><a name="cloning"></a>Cloning</h1>

<p><code>MooseX::Extended</code> offers optional, <strong>EXPERIMENTAL</strong> support for attribute
cloning, but differently from how we see it typically done. You can just pass
the <code>clone =&gt; 1</code> argument to your attribute and it will be clone with
<code>Storable</code>‘s <code>dclone</code> function every time you read or write that attribute,
it will be cloned if it’s a reference, ensuring that your object is
effectively immutable.</p>

<p>If you prefer, you can also pass a code reference or the name of a method you
will use to clone the object. Each will receive three arguments:
<code>$self, $attribute_name, $value_to_clone</code>. Here’s a full example, taken
from our test suite.</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">package My::Event;
use MooseX::Extended types =&gt; [qw(NonEmptyStr HashRef InstanceOf)];

param name =&gt; ( isa =&gt; NonEmptyStr );

param payload =&gt; (
    isa    =&gt; HashRef,
    clone  =&gt; 1,  # uses Storable::dclone
    writer =&gt; 1,
);

param start_date =&gt; (
    isa   =&gt; InstanceOf ['DateTime'],
    clone =&gt; sub ( $self, $name, $value ) {
        return $value-&gt;clone;
    },
);

param end_date =&gt; (
    isa    =&gt; InstanceOf ['DateTime'],
    clone  =&gt; '_clone_end_date',
);

sub _clone_end_date ( $self, $name, $value ) {
    return $value-&gt;clone;
}

sub BUILD ( $self, @ ) {
    if ( $self-&gt;end_date &lt; $self-&gt;start_date ) {
        croak(&quot;End date must not be before start date&quot;);
    }
}
</code></pre></div>

<h1><a name="customization"></a>Customization</h1>

<p>Not everyone likes <code>MooseX::StrictConstructor</code>. It’s useful to prevent this 
error:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">my $name = My::Name-&gt;new( naem =&gt; 'Ovid' );
</code></pre></div>

<p>In bog-standard Moose, the misspelled attribute will be discarded, leading to 
bugs that can be hard to track down. However, some code (such as 
<a href="https://metacpan.org/pod/DBIx::Class" target="_blank">DBIx::Class</a> <span class="fa fa-external-link fa_custom"></span>), breaks with a strict 
constructor. You can skip that:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">use MooseX::Extended excludes =&gt; [qw/StrictConstructor/];
</code></pre></div>

<p>Both <code>MooseX::Extended</code> and <code>MooseX::Extended::Role</code> have a variety of features 
you can exclude if they don’t work for you. Again, see the documentation.</p>

<p>Note that at the present time, this customization is <em>per class</em> and cannot be 
inherited. This may change in a future release.</p>

<h1><a name="conclusion"></a>Conclusion</h1>

<p>There’s a lot more packed into <code>MooseX::Extended</code>, but this covers the 
highlights. I think <code>MooseX::Extended</code> will make many Perl programmer’s life 
easier if they use Moose, but want a better set of defaults.  It’s still in 
ALPHA, but it' close to a feature-complete BETA release. I <em>think</em> it’s 
relatively solid, but no guarantees. The <a href="https://github.com/Ovid/moosex-extreme" target="_blank">github 
repo</a> <span class="fa fa-external-link fa_custom"></span> has Linux and Windows CI workflows 
set up to catch errors quickly and the test suite is coming along nicely.</p>

<p>If you’re interested in starting any new projects using Moose, please give 
<code>MooseX::Extended</code> a try and let me know what you think.</p>




          <p><strong>Please leave a comment below!</strong></p>



<hr>
    <div class="prevNext">
        
        <a href="/articles/common-problems-in-object-oriented-code.html" class="prevPost">&laquo; Common Problems in Object-Oriented Code</a>
        
        <a href="/#" class="nextPost"></a>
    </div>

<hr>

          <p>If you'd like top-notch consulting or training, <a
          href="mailto:curtis.poe@gmail.com">email me</a> and let's discuss
          how I can help you. Read my <a href="/hireme.html">hire me</a> page
          to learn more about my background.</p>
        </div>
    </div>
<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <div class="row">
      <div class="three columns">
        <p></p>
      </div>
      <div class="nine columns">
        <hr>
        <p>Copyright &copy; 2018-2022 by Curtis “Ovid” Poe.</p>
      </div>
    </div>
        <div id="disqus_thread"></div>
    <div class="row">
      <div class="twelve columns">
      
        <script>
        var disqus_config = function () {
            this.page.url        = "https://ovid.github.io/articles/introducing-moosexextended-for-perl.html";
            this.page.identifier = "articles/introducing-moosexextended-for-perl";
            this.page.title      = "Introducing MooseX::Extended for Perl";
        };
        (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://https-ovid-github-io.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      
        </div>
    </div>
    </div>
    
    <script src="/static/js/prism.js"></script>
    
	
</body>
</html>


