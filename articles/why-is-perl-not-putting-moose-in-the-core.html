

<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Facebook -->

  <meta property="fb:app_id" content="329861788447703" />
  
  
  <meta property="og:image" content="https://ovid.github.io/static/images/facebook/corinna.jpg" />
  <meta property="og:image:type" content="image/jpeg" />
  <meta property="og:image:alt" content="An ancient painting of Ovid and Corinna" />
  
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://ovid.github.io/articles/why-is-perl-not-putting-moose-in-the-core.html" />
  <meta property="og:title" content="Why is Perl not putting Moose in the core?" />
  <meta property="og:description" content="People keep asking why the Perl language doesn't just drag the Moose module into the core for object-oriented programming. Buckle up, this will be a long trip ..." />

  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-129723079-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-129723079-1');
  </script>


  <!-- Basic Page Needs -->
  <meta charset="utf-8">
  <title>Why is Perl not putting Moose in the core?</title>
  <meta name="description" content="Why is Perl not putting Moose in the core?">
  <meta name="author" content="Curtis Poe">
  <link rel="alternate" type="application/rss+xml" title="Subscribe to my technical blog" href="https://ovid.github.io/article.rss" />
  <link rel="alternate" type="application/rss+xml" title="Subscribe to my personal blog" href="https://ovid.github.io/blog.rss" />

  <!-- Mobile Specific Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS -->
  <link rel="stylesheet" href="/static/css/normalize.css">
  <link rel="stylesheet" href="/static/css/skeleton.css">
  <link rel="stylesheet" href="/static/css/main.css">
  <link rel="stylesheet" href="/static/css/dialog.css">
  <link rel="stylesheet" href="/css/layout.css">
    <link rel="stylesheet" type="text/css" href="/static/css/prism.css"/> 
    

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="images/favicon.png">

</head>
<body>

  <!-- Primary Page Layout -->
  <div class="container">
    <div class="row books">
        <div class="twelve columns header">
			<ul>
			<li><a
            href="https://www.amazon.com/Perl-Hacks-Programming-Debugging-Surviving/dp/0596526741/"
            target="_blank"><img src="/static/images/perl-hacks.jpg"
            alt="The cover of the 'Perl Hacks' book" class="book"></a></li>
			<li><a
            href="https://www.amazon.com/Beginning-Perl-Curtis-Poe/dp/1118013840/"
            target="_blank"><img src="/static/images/beginning-perl.jpg"
            alt="The cover of the 'Beginning Perl' book" class="book"></a></li>
			<li><img class="book" src="/static/images/profile.png" alt="An
            image of Curtis Poe, holding some electronic equipment in front of
            his face."></li>
			</ul>
        </div>
    </div>
    <div class="row title">
        <!-- Back to top button -->
        <span aria-hidden="true"><a href="#top" class="arrow"><button id="scrollToTopButton">↑</button></a></span>
        <h1>Why is Perl not putting Moose in the core?</h1>
        <time>2021-11-22</time>
        <hr>
        <div class="twelve columns header">
        </div>
    </div>
    <div class="row">
      <div class="three columns">
        <ul>
          <li><a href="/index.html">Home</a></li>
          <li><a href="/articles.html">Technical Articles</a> <a href="/article.rss"><img border="0" alt="Subscribe to Articles by Ovid" src="/static/images/rss.png" width="12" height="12"/></a></li>
          <li><a href="/blog.html">Blog</a> <a href="/blog.rss"><img border="0" alt="Subscribe to Blogs by Ovid" src="/static/images/rss.png" width="12" height="12"/></a></li>
          <li><a href="/hireme.html">Hire Me</a></li>
          <li><a href="/publicspeaking.html">Public Speaking</a></li>
          <li><a href="/wildagile.html">WildAgile</a></li>
          <li><a href="/tau-station.html">Tau Station</a></li>
          <li><a href="/starmap.html">Starmap</a></li>
        </ul>
      </div>

        <div class="nine columns verticalLine article">

    <div class="prevNext">
        
        <a href="/articles/language-design-consistency.html" class="prevPost">&laquo; Language Design Consistency</a>
        
        <a href="/#" class="nextPost"></a>
    </div>

        <hr>


<p>As you may know, I’m designing <a href="/articles/language-design-consistency.html">a new OO system for the Perl
language</a>. People keep asking why
we don’t just put <a href="https://metacpan.org/pod/Moose" target="_blank">Moose</a> <span class="fa fa-external-link fa_custom"></span> in the Perl core and
no matter how many times I explain it, for a certain subset of people, that
explanation isn’t satisfactory. If there is one thing I’ve learned from years
of being in technology, it’s that there will always be a subset of naysayers
and you can’t sway them, not matter your arguments (I still remember the days
when there was a group of die-hards who wanted the web to return to a simpler
time where images weren’t allowed).</p>

<p>So this is not for those naysayers. It’s for everyone else who is curious
about why Perl <em>might</em> adopt the Corinna proposal for native object-oriented
programming (hereinafter referred to as OOP), even when the Perl 5 Porters
have rejected Moose.</p>

<h1>What’s an Object in Perl?</h1>

<p>If you know Perl, the answer to the above question is “nothing.” Perl knows
nothing about OOP. It doesn’t know what objects are. Instead, <a href="https://perldoc.perl.org/perlobj" target="_blank">there are a few
features introduced in Perl 5</a> <span class="fa fa-external-link fa_custom"></span> to give one a
basic toolkit for handling OOP code.</p>

<ol>
<li>An object is simply a data structure that knows to which class it belongs.</li>
<li>A class is simply a package. A class provides methods that expect to
operate on objects.</li>
<li>A method is simply a subroutine that expects a reference to an object (or a
package name, for class methods) as the first argument.</li>
<li>You inherit from a class by adding its name to your namespace’s <code>@ISA</code>
array.</li>
</ol>

<p>Does that sound like a kludge? It is, but it’s worked well enough that
developers without much experience in OOP have accepted this.</p>

<p>It’s actually kinda rubbish because it’s more or less an assembler language
for OOP, but it works. In fact, it’s modeled after Python’s original
implementation of objects, but with changes to take into account that we are
not, in fact, Python.</p>

<p>So imagine a <code>Person</code> class written in core Perl. You have a read/write name
and that’s all. We’ll keep it simple. This is what you used to see in OOP
Perl.</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">package Person;

use strict;
use warnings;

sub new {
    my ( $class, $name ) = @_;
    return bless { name =&gt; $name } =&gt; $class; # this is the instance
}

sub name {
    my $self = shift;
    if (@_) {
        $self-&gt;{name} = shift;
    }
    return $self-&gt;{name};
}

# this is a magical &quot;true&quot; value that all packages/modules/whatever
# need to return to let Perl know that it loaded successfully.
1;
</code></pre></div>

<p>So you want to subclass that and create a <code>Person::Employee</code> and need to
keep their salary private:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">package Person::Employee;

use strict;
use warnings;
our @ISA = 'Person';

sub new {
    my ( $class, $name, $salary ) = @_;
    my $self = $class-&gt;SUPER::new($name);
    $self-&gt;{salary} = $salary;
    return $self;
}

# the leading underscore says &quot;this is private, stay out&quot;
sub _salary {
    my $self = shift;
    return $self-&gt;{salary};
}

1;
</code></pre></div>

<p>OK, kinda clumsy, but it works. However, if you want to see the salary:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">use Data::Dumper;
print Dumper($employee);
</code></pre></div>

<p>Admittedly, salary is often very secret and the above code is rubbish,
but there’s plenty of other data that isn’t really secret, but you don’t want
to expose it because it’s not part of the interface and people shouldn’t rely
on it. But what’s going on with that leading underscore?</p>

<p>In Python, you won’t get a method for that, but if you know how the method
names are mangled under the hood, you can jump through hoops and call them.
For Perl, you just have that method. Developers know they shouldn’t call them,
but I investigated three code bases from our various clients and found:</p>

<ul>
<li>Codebase 1: very good Perl, lots of tests, tremendous disciple,  and 72
calls to private methods outside the class (or sublclass) they were defined
in)</li>
<li>Codebase 2: very sloppy Perl, few tests, and an organizational mess, but
only 59 calls to private methods (to be fair, it was a smaller codebase, but
not by much)</li>
<li>Codebase 3: a combination of miserable and wonderful Perl, almost no tests,
and the largest code base we have ever worked with. Over 60K calls to
private methods.</li>
</ul>

<p>“Private” methods in Perl are not private. At all. You have a deadline, you
have a very hit-or-miss codebase, and you put something together as fast as
you can. All of a sudden, the “private” code isn’t very private any more.</p>

<p>What this means is that your private methods are now part of the public
interface whether you like that or not. You might <em>think</em> you can change
them, but you do so at the risk of wide-spread carnage.</p>

<p>So, let’s look at Moose.</p>

<h1>Moose</h1>

<p>Here’s the person class (using only core Moose and no other helper modules):</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">package Person;
use Moose;

has name =&gt; (
    is       =&gt; 'rw',
    isa      =&gt; 'Str',
    required =&gt; 1,
);

__PACKAGE__-&gt;meta-&gt;make_immutable;
</code></pre></div>

<p>Right off the bat, for this simplest of classes, it’s shorter, it’s entirely
declarative, and it’s arguably more correct. For example, you can’t do
<code>$person-&gt;name(DateTime-&gt;now)</code> as you could have with the core OOP example.
You could fix that with the core example with a touch more code, but you’d
have to do tha with every method you wrote.</p>

<p>You have to change construction a bit, too. Either of the following works:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">my $person = Person-&gt;new( name =&gt; 'Bob' );
# or
my $person = Person-&gt;new({ name =&gt; 'Bob' });
</code></pre></div>

<p>Why two different ways? Who knows. Live with it.</p>

<p>But what about the subclass?</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">package Person::Employee;
use Moose;
BEGIN { extends 'Person' }

has _salary =&gt; (
    is       =&gt; 'ro',
    isa      =&gt; 'Num',
    init_arg =&gt; 'salary',
);

__PACKAGE__-&gt;meta-&gt;make_immutable;
</code></pre></div>

<p>And to create an instance:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">my $employee = Person::Employee-&gt;new(
    name   =&gt; 'Bob',
    salary =&gt; 50000,
);
</code></pre></div>

<p>And we don’t have a <code>-&gt;salary</code> method, but we can still access <code>-&gt;_salary</code>.
Hmm, not good.</p>

<p>There are ways we can work around this, but none are pleasant.</p>

<p>And finally, Corinna.</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">class Person {
    has $name :reader :writer :param;
}
</code></pre></div>

<p>Hmm, that looks pretty easy, but what about that ugly salary problem?</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">class Person::Employee :isa(Person) {
    has $salary :param;
}
</code></pre></div>

<p>Now, internally, everthing has access to <code>$salary</code>, but nothing outside
the class does. It’s no longer part of the public API and that’s a huge 
win.</p>

<p>It’s also a huge win that <code>$salary</code> is just a local variable and we don’t have
to keep doing method lookups to get it. With the Paul Evan’s <code>Object::Pad</code>
testbed for Corinna, that’s been a huge performance gain, despite little work
being done on optimization.</p>

<h1>So What?</h1>




          <p><strong>Please leave a comment below!</strong></p>



<hr>
    <div class="prevNext">
        
        <a href="/articles/language-design-consistency.html" class="prevPost">&laquo; Language Design Consistency</a>
        
        <a href="/#" class="nextPost"></a>
    </div>

<hr>

          <p>If you'd like top-notch consulting or training, <a
          href="mailto:curtis.poe@gmail.com">email me</a> and let's discuss
          how I can help you. Read my <a href="/hireme.html">hire me</a> page
          to learn more about my background.</p>
        </div>
    </div>
<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <div class="row">
      <div class="three columns">
        <p></p>
      </div>
      <div class="nine columns">
        <hr>
        <p>Copyright &copy; 2018-2021 by Curtis “Ovid” Poe.</p>
      </div>
    </div>
        <div id="disqus_thread"></div>
    <div class="row">
      <div class="twelve columns">
      
        <script>
        var disqus_config = function () {
            this.page.url        = "https://ovid.github.io/articles/why-is-perl-not-putting-moose-in-the-core.html";
            this.page.identifier = "articles/why-is-perl-not-putting-moose-in-the-core";
            this.page.title      = "Why is Perl not putting Moose in the core?";
        };
        (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://https-ovid-github-io.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      
        </div>
    </div>
    </div>
    
    <script src="/static/js/prism.js"></script>
    
	
</body>
</html>


