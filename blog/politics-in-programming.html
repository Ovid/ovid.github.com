

<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Facebook -->

  <meta property="fb:app_id" content="329861788447703" />
  
  
  <meta property="og:image" content="https://ovid.github.io/static/images/facebook/corinna.jpg" />
  <meta property="og:image:type" content="image/jpeg" />
  <meta property="og:image:alt" content="An ancient painting of Ovid and Corinna" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="https://ovid.github.io/blog/politics-in-programming.html" />
  
  <meta property="og:title" content="Politics in Programming" />
  <meta property="og:description" content="Designing the Corinna OO system for Perl has been as much a political exercise as a technical one. This has been a good thing." />

  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-129723079-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-129723079-1');
  </script>


  <!-- Basic Page Needs -->
  <meta charset="utf-8">
  <title>Politics in Programming</title>
  <meta name="description" content="Politics in Programming">
  <meta name="author" content="Curtis Poe">
  <link rel="alternate" type="application/rss+xml" title="Subscribe to my technical blog" href="https://ovid.github.io/article.rss" />
  <link rel="alternate" type="application/rss+xml" title="Subscribe to my personal blog" href="https://ovid.github.io/blog.rss" />

  <!-- Mobile Specific Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS -->
  <link rel="stylesheet" href="/static/css/normalize.css">
  <link rel="stylesheet" href="/static/css/skeleton.css">
  <link rel="stylesheet" href="/static/css/main.css">
  <link rel="stylesheet" href="/static/css/dialog.css">
  <link rel="stylesheet" href="/css/layout.css">
    <link rel="stylesheet" type="text/css" href="/static/css/prism.css"/> 
    

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="images/favicon.png">

</head>
<body>

  <!-- Primary Page Layout -->
  <div class="container">
    <div class="row books">
        <div class="twelve columns header">
			<ul>
			<li><a
            href="https://www.amazon.com/Perl-Hacks-Programming-Debugging-Surviving/dp/0596526741/"
            target="_blank"><img src="/static/images/perl-hacks.jpg"
            alt="The cover of the 'Perl Hacks' book" class="book"></a></li>
			<li><a
            href="https://www.amazon.com/Beginning-Perl-Curtis-Poe/dp/1118013840/"
            target="_blank"><img src="/static/images/beginning-perl.jpg"
            alt="The cover of the 'Beginning Perl' book" class="book"></a></li>
			<li><img class="book" src="/static/images/profile.png" alt="An
            image of Curtis Poe, holding some electronic equipment in front of
            his face."></li>
			</ul>
        </div>
    </div>
    <div class="row title blog">
        <!-- Back to top button -->
        <span aria-hidden="true"><a href="#top" class="arrow"><button id="scrollToTopButton">↑</button></a></span>
        <h1><a name="-title-no-title-found-"></a>Politics in Programming</h1>
        <time>2021-08-21</time>
        <hr>
        <div class="twelve columns header">
        </div>
    </div>
    <div class="row">
      
      <div class="three columns">
        <ul>
          <li><a href="/index.html">Home</a></li>
          <li><a href="/articles.html">Technical Articles</a> <a href="/article.rss"><img border="0" alt="Subscribe to Articles by Ovid" src="/static/images/rss.png" width="12" height="12"/></a></li>
          <li><a href="/blog.html">Blog</a> <a href="/blog.rss"><img border="0" alt="Subscribe to Blogs by Ovid" src="/static/images/rss.png" width="12" height="12"/></a></li>
          <li><a href="/hireme.html">Hire Me</a></li>
          <li><a href="/publicspeaking.html">Public Speaking</a></li>
          <li><a href="/wildagile.html">WildAgile</a></li>
          <li><a href="/tau-station.html">Tau Station</a></li>
          <li><a href="/starmap.html">Starmap</a></li>
        </ul>
        <hr>
        <strong>Find me on ...</strong>
        <ul>
          <li><a href="https://twitter.com/OvidPerl">Twitter</a></li>
          <li><a href="https://github.com/Ovid/">GitHub</a></li>
          <li><a href="https://www.linkedin.com/in/curtispoe/">LinkedIn</a></li>
        </ul>
        <hr>
        <strong>Tags</strong>
        <ul class="cloud" role="navigation" aria-label="Tag cloud for Ovid's site">
        
            
            
            <li><a href="/tags/business.html" data-weight="9">Business</a></li>
        
            
            
            <li><a href="/tags/corinna.html" data-weight="8">Corinna</a></li>
        
            
            
            <li><a href="/tags/databases.html" data-weight="8">Databases</a></li>
        
            
            
            <li><a href="/tags/expat.html" data-weight="1">Moving Abroad</a></li>
        
            
            
            <li><a href="/tags/family.html" data-weight="4">Family</a></li>
        
            
            
            <li><a href="/tags/math.html" data-weight="4">Math</a></li>
        
            
            
            <li><a href="/tags/oop.html" data-weight="9">OOP</a></li>
        
            
            
            <li><a href="/tags/perl.html" data-weight="8">Perl</a></li>
        
            
            
            <li><a href="/tags/personal.html" data-weight="3">Personal</a></li>
        
            
            
            <li><a href="/tags/politics.html" data-weight="6">Politics</a></li>
        
            
            
            <li><a href="/tags/programming.html" data-weight="9">Programming</a></li>
        
            
            
            <li><a href="/tags/space.html" data-weight="3">Space</a></li>
        
            
            
            <li><a href="/tags/writing.html" data-weight="7">Writing</a></li>
        
        </ul>
      </div>

        <div class="nine columns verticalLine article">

        <div class="prevNext">
        
        <a href="/blog/resigning-from-the-perl-foundation.html" class="prevPost">&laquo; Resigning From The Perl Foundation</a>
        
        <a href="/blog/jeff-bezos-1000-problems.html" class="nextPost">What's Wrong with Blue Origin? &raquo;</a>
    </div>

    

<ul class="inline" role="navigation" aria-label="Tag list for this blog">
    <li>Tags:</li>

    <li><a href="/tags/corinna.html">Corinna</a> </li>

</ul>


        <hr>
    <blockquote> We're hiring experienced Perl developers for full-time
<em>remote</em> contracts on a number of projects. If you are interested, <a
href="mailto:curtis.poe@gmail.com">email me</a>. We also have one potential
role for an experienced Python developer with OpenAPI + ORM experience.
</blockquote> 

<hr/>



<p><nav role="navigation" class="table-of-contents">
    <ul>
    <li class="indent-1"><a href="#corinnas-first-missteps">Corinna’s First (mis)Steps</a></li>
    <li class="indent-2"><a href="#good-oo-design">Good OO Design</a></li>
    <li class="indent-2"><a href="#my-mistake">My Mistake</a></li>
    <li class="indent-2"><a href="#politics">Politics</a></li>
    <li class="indent-1"><a href="#class-data-and-methods">Class Data and Methods</a></li>
    <li class="indent-2"><a href="#inclusion">Inclusion</a></li>
    <li class="indent-2"><a href="#semantics">Semantics</a></li>
    <li class="indent-2"><a href="#syntax">Syntax</a></li>
    <li class="indent-2"><a href="#state-variables">State Variables</a></li>
    <li class="indent-1"><a href="#the-future">The Future</a></li>
    <li class="indent-1"><a href="#conclusion">Conclusion</a></li>
    <li class="indent-1"><a href="#update">Update</a></li>
    </ul>
</nav>
<hr></p>

<h1><a name="corinnas-first-missteps"></a>Corinna’s First (mis)Steps</h1>

<p>Note: Corinna is the name of Ovid’s love interest in <a href="https://www.gutenberg.org/files/47676/47676-h/47676-h.htm" target="_blank">the
Amores</a> <span class="fa fa-external-link fa_custom"></span>.</p>

<hr />

<p>I had been working on the design for Corinna, a proposed <a href="https://github.com/Ovid/Cor" target="_blank">object system for
the Perl core</a> <span class="fa fa-external-link fa_custom"></span>, for several months, inspired by
the work of <a href="https://metacpan.org/author/STEVAN" target="_blank">Stevan Little</a> <span class="fa fa-external-link fa_custom"></span>, pulling ideas
from many other sources, including far too much reading about effective
object-oriented design. <a href="https://metacpan.org/author/XSAWYERX" target="_blank">Sawyer X</a> <span class="fa fa-external-link fa_custom"></span>, then
the Perl pumpking (a now defunct role, but it was the person overseeing Perl
language development), urged me to stop working on the implementation and just
focus on the design. Design something great and he’d find someone to implement
it.</p>

<p>When I first announced Corinna (then known as “Cor”), it was met with
enthusiasm, indifference, and hostility, depending on whom you asked. In fact,
I was convinced that what I had proposed was solid enough that I was sure the
community would buy into it easily. They did not.</p>

<p>Truth be told, they were right to not get excited. Ignoring the fact that
people have wanted to get an object system in the Perl core for years and no
one had succeeded, the fact is that Corinna wasn’t really that interesting in
terms of an OO system for the Perl community. I had spent so much time
researching good OO practices that I hadn’t take into consideration the impact
of decades of ingrained behaviors in the Perl community. Here’s what an early
version looked like.</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">class Cache::LRU v0.01 {
    use Hash::Ordered;

    has cache    =&gt; ( default =&gt; method { Hash::Ordered-&gt;new } );
    has max_size =&gt; ( default =&gt; method { 20 } );

    method set ( $key, $value ) {
        if ( self-&gt;cache-&gt;exists($key) ) {
            self-&gt;cache-&gt;delete($key);
        }
        elsif ( self-&gt;cache-&gt;keys &gt; self-&gt;max_size ) {
            self-&gt;cache-&gt;shift;
        }
        self-&gt;cache-&gt;set( $key, $value );
    }

    method get ($key) {
        if ( $self-&gt;exists($key) ) {
            my $value = $self-&gt;cache-&gt;get($key);
            $self-&gt;set( $key, $value );  # put it at the front
            return $value;
        }
        return;
    }
}
</code></pre></div>

<p>I won’t bore you with the details of the bad decisions I made, but you can
read <a href="https://gist.github.com/Ovid/68b33259cb81c01f9a51612c7a294ede" target="_blank">the initial Corinna specification
here</a> <span class="fa fa-external-link fa_custom"></span>. Let’s
look at one mistake I made in that specification:</p>

<blockquote>
  <p>Note: “slots” are internal data for the object. They provide no public API.
  By not defining standard <code>is =&gt; 'ro'</code>, <code>is =&gt; 'rw'</code>, etc., we avoid the trap
  of making it natural to expose everything. Instead, just a little extra work
  is needed by the developer to wrap slots with methods, thereby providing an
  affordance to keep the public interface smaller (which is generally accepted
  as good OO practice).</p>
</blockquote>

<p>So you couldn’t call <code>$self-&gt;cache</code> or <code>$self-&gt;max_size</code> outside of the class.</p>

<h2><a name="good-oo-design"></a>Good OO Design</h2>

<p>So I said encapsulation is “generally accepted as good OO practice.”</p>

<p>Yes, that’s true. And if you’re very familiar with OO design best practices,
you might even agree. Java developers learned a long time ago not to make
their object attributes public, but Perl, frankly, didn’t really have simple
ways of enforcing encapsulation. In fact, in the early days of OO prorgamming
in Perl, you’d often see an object constructed like this:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">package SomeClass;

sub new {
    my ( $class, $name ) = @_;
    bless {
        name   =&gt; $name,
        _items =&gt; [],
    }, $class;
}

1;
</code></pre></div>

<p>With that, even outside the class you could inspect data with
<code>$object-&gt;{name}</code> and <code>$object-&gt;{_items}</code>. But why the leading underscore on
<code>_items</code>?  Because that was a signal to other developers that <code>_items</code> was
meant to be private. It was asking them to not touch that because Perl didn’t
offer an easy way to ensure encapsulation.</p>

<p>Something similar for Moo/se could be written like this:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">package SomeClass;
use Moose;

has &#39;name&#39; =&gt; (
    is       =&gt; &#39;ro&#39;,
    isa      =&gt; &#39;Str,
    required =&gt; 1,
);

has &#39;_items&#39; =&gt; (
    is       =&gt; &#39;ro&#39;,
    isa      =&gt; &#39;ArrayRef&#39;,
    default  =&gt; sub {[]},
    init_arg =&gt; undef,
);

1;
</code></pre></div>

<p>That almost the same thing, but now you have a reader for <code>$object-&gt;_items</code>
and you still don’t get encapsulation. Bad, right?</p>

<p>Well, yeah. That’s bad. <a href="https://allaroundtheworld.fr" target="_blank">All Around the World</a> <span class="fa fa-external-link fa_custom"></span>
has repeatedly gone into clients and fixed broken code which is broken for no
other reason than not respecting encapsulation (drop me a line if you’d like
to hire us).</p>

<p>There have been attempts to introduce <a href="https://metacpan.org/pod/Class::Std" target="_blank">“inside-out”
objects</a> <span class="fa fa-external-link fa_custom"></span> which properly encapsulate their
data, but these have never caught on. They are awkward to write and, most
importantly, you can’t just call <code>Dumper($object)</code> to see its internal state
while debugging. That alone may have killed them.</p>

<h2><a name="my-mistake"></a>My Mistake</h2>

<p>So if encapsulation is good, and violating encapsulation is bad, why were
people upset with my proposal?</p>

<p>Amongst other things, if I wanted to expose the <code>max_size</code> slot directly, I had
to write a helper method:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">class Cache::LRU v0.01 {
    use Hash::Ordered;

    has cache    =&gt; ( default =&gt; method { Hash::Ordered-&gt;new } );
    has max_size =&gt; ( default =&gt; method { 20 } );

    method max_size () { return self-&gt;max_size }

    ...
}
</code></pre></div>

<p>If I wanted people to be able to <em>change</em> the max size value:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">method max_size ($new_size) {
    if (@_ &gt; 1) { # guaranteed to confuse new developers
        self-&gt;max_size($new_size);
    }
    else {
        return self-&gt;max_size;
    }
}
</code></pre></div>

<p>And there are many, many ways to write the above and get it wrong. Corinna is
supposed to make it easier to focus on writing good OO code. Here, it was
letting developers fall back to writing bad code that Corinna could easily
write. Why should people have to write it? If I offered some convenience here,
how should it look? Enough people argued against the design that I realized I
made a mistake. Maybe encapsulation is good, but my strictness was over the
top. Which leads me to the entire point of this blog entry:</p>

<p><strong>If you’re not effective, it doesn’t matter if you’re right.</strong></p>

<p>Was I right to strive for such encapsulation? I honestly don’t know, but if it
meant that no one would use my OO system, it didn’t matter. I had to change
something.</p>

<h2><a name="politics"></a>Politics</h2>

<p>It was pointed out to me that since I had been working in isolation, I hadn’t
had the chance to hear, much less incorporate, the views of others. It was
time for politics.</p>

<p>Out of all of the online definitions about politics, I really like <a href="https://en.wikipedia.org/wiki/Politics" target="_blank">the
opening of Wikipedia</a> <span class="fa fa-external-link fa_custom"></span> the best:</p>

<blockquote>
  <p>Politics is the set of activities that are associated with making decisions
  in groups ...</p>
</blockquote>

<p>That’s it. People often hate the word “politics” and say things like “politics
has no place in the workplace” (or community, or mailing list, or whatever).
But politics is nothing more than helping groups form a consensus. When you
have a group as large as the Perl community, if you’re not interested in
forming a consensus for a large project, you’ve already put yourself behind
the eight ball and that’s what I had done.</p>

<p><figure class="image">
    <img src="/static/images/eight-ball.jpg" width="600" alt="An eight ball on a pool table.">
    <figcaption><a href="https://unsplash.com/photos/LsEL4F5POBI" target="_blank">Source</a> <span class="fa fa-external-link fa_custom"></span></figcaption>
</figure></p>

<p>So an IRC channel was created (irc.perl.org #cor) and a <a href="https://github.com/Ovid/Cor" target="_blank">github
project</a> <span class="fa fa-external-link fa_custom"></span> was started and anyone with an interest
in the project was welcome to share their thoughts.</p>

<p>To be honest, this was challenging for me. First, I don’t respond well to
profanity or strong language and there were certainly some emotions flying in
the early days. Second, nobody likes being told their baby is ugly, and people
were telling me that. For example, when I was trying to figure out how to
handle class data, here’s part of the conversation (if you leave a comment, I
will delete it if it’s identifying this person):</p>

<ul>
<li>developer: Ovid: this is not an attack on you or at all, I’m just about to rant about class data, ok</li>
<li>developer: class data is bullSHIT</li>
<li>developer: there is no such thing</li>
<li>developer: it’s a stupid-ass excuse in java land for them not having globals</li>
<li>developer: just make it a fucking global</li>
<li>developer: or a fucking constant method</li>
<li>developer: sub foo { ‘value' }</li>
<li>developer: there, it’s a constant method, it’s fine, fuck off</li>
</ul>

<p>When I see things like that, I tend to tune out. That’s not helpful when I
need to understand where people are coming from. And I’ve read that multiple
times and I still don’t see the technical argument there (to be fair, this
went on for a bit, but I saw nothing explaining why global variables are
better than class data. It could just be that I’m a bear of little brain).</p>

<p>I strongly disagree that globals are better than class data because I’ve
worked on codebases with plenty of globals and, even if they’re immutable,
there’s the lifecycle question of when the come into existence.  Plus, class
data is clearly associated with a class, so at the very least, when I call <code>my
$foo = SomeClass-&gt;data</code> (assuming it’s needed outside the class), the class
can maintain responsibility for what that data is. Or if the class data is
private to the class (as it often is), a global breaks that entirely. But
nonetheless, I have to get buy-in for Corinna and that means listening to
people and trying to figure out what the real complaints were and how (and
whether) to address them.</p>

<p>This worked well for slot encapsulation because we eventually came up with
this:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">slot $name :reader :writer;
</code></pre></div>

<p>The <code>$name</code> variable can be read via <code>$object-&gt;name</code> and can be set via
<code>$object-&gt;set_name($new_name)</code>. Yes, this tremendously violates encapsulation
because Corinna does not yet have a way of enforcing type constraints, but
mutability at least isn’t the default. And when we later incorporate type
constraints, the external interface of the classes won’t have to change. I got
buy-in for the design, at the cost of slightly compromising some of my design
goals. I think it’s a good trade off and I think Corinna is better off for
this.</p>

<p>But what about class data?</p>

<h1><a name="class-data-and-methods"></a>Class Data and Methods</h1>

<p>Should we include class data and methods in Corinna? I discovered that for
many people, the answer was obvious, but their obvious answers disagreed with
other people’s obvious answers. What makes it worse is that this isn’t just a
“yes or no” question. We have multiple questions.</p>

<ol>
<li>Should we include class data and methods?</li>
<li>What should the semantics be?</li>
<li>What should the syntax be?</li>
</ol>

<p>This isn’t easy. We got past one and two with difficulty, but number three has
been a bit of a trainwreck. And I’m the conductor.</p>

<h2><a name="inclusion"></a>Inclusion</h2>

<p>I think it was pretty much universally agreed that we had to have class
methods. These wouldn’t have <code>$self</code> injected into them, nor would they have
any access to instance data. In fact, done properly, we could make violations
of that a compile-time failure. That’s a huge win for Perl. They might look
like this:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">slot $some_data; # instance data

common method foo() {
    # $class is available here
    # $self and $some_data are not available here
}
</code></pre></div>

<p>One use of those is for alternate constructors. In Moo/se, you have
<code>BUILDARGS</code> for fiddling with arguments to <code>new</code>. In Corinna, at least for the
MVP, you write an alternate constructor (we don’t have method overloading in
Perl).</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">class Box {
    slot ( $height, $width, $depth ) :param;
    slot $volume :reader = $height * $width * $depth;

    common method new_cube ($length) {
        return $class-&gt;new(
            height =&gt; $length,
            width  =&gt; $length,
            depth  =&gt; $length,
        );
    }
}
</code></pre></div>

<p>With the above, you can create a cube with <code>Box-&gt;new_cube(3)</code>. No more
messing around with <code>BUILDARGS</code> and trying to remember the syntax.</p>

<p>So if we should have class methods, should we have class data? Well, it’s been
pointed out that it’s literally impossible to avoid:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">class Box {
    my $num_instances = 0;      # class data!!

    slot ( $height, $width, $depth ) :param;
    slot $volume :reader = $height * $width * $depth;

    ADJUST   { $num_instances++ }
    DESTRUCT { $num_instances-- }

    common method new_cube ($length) {
        return $class-&gt;new(
            height =&gt; $length,
            width  =&gt; $length,
            depth  =&gt; $length,
        );
    }

    common method inventory_count () { $num_instances }
}
</code></pre></div>

<p>So at a very practical level, whether or not we want class data, we have it.
In fact, even if we omitted class methods, we’d still have class data. So
let’s work with what we have.</p>

<h2><a name="semantics"></a>Semantics</h2>

<p><a href="https://github.com/Ovid/Cor/wiki/Class-Data-and-Methods" target="_blank">We have a lot of the semantics described
here</a> <span class="fa fa-external-link fa_custom"></span>, but it could
use some more work. However, the general idea of behavior isn’t controversial
enough that I want to spend too much time here.</p>

<h2><a name="syntax"></a>Syntax</h2>

<p>Now we have a problem. In Moo/se, we <code>BUILD</code>, <code>DEMOLISH</code>, and <code>has</code>, which
have been renamed to <code>ADJUST</code>, <code>DESTRUCT</code>, and <code>slot</code> in Corinna in part
because they’re different beasts. We don’t want to have <code>BUILD</code> in Corinna
and have Moo/se developers think it’s the same thing. If we get an analog to
<code>BUILDARGS</code>, it will probably be called <code>CONSTRUCT</code> for the same reason.</p>

<p>So one of our design goals is that different things should look different.</p>

<p>Another design goal is that we do not wish to overload the meaning of things.
Thus, we agreed that reusing the <code>class</code> keyword (<code>class method foo() {...}</code>
or <code>class slot $foo</code>) was probably a bad idea (it turns out to be
spectacularly bad if we get to inner classes, but let’s not go there yet).</p>

<p>By the same reasoning that “different things should look different,” similar
things should look similar. In Java, class data and methods are declared with
the <code>static</code> keyword.</p>

<div class="shadow"><pre class="scrolled"><code class="language-java">public class MyClass {
    private String name;

    // class data
    public static int numberOfItems;

    public MyClass(String name) {
        this.name = name;
    }

    // class method
    public static void setSomeClassData(int value) {
        MyClass.numberOfItems = value;
    }
}
</code></pre></div>

<p>A developer can easily understand how the two are analogous. But do
we need this for Corinna? Here’s the “accidental” class data we could not
avoid.</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">class Box {
    my $num_instances = 0;      # class data!!

    slot ( $height, $width, $depth ) :param;
    slot $volume :reader = $height * $width * $depth;

    ADJUST   { $num_instances++ }
    DESTRUCT { $num_instances-- }

    common method new_cube ($length) {
        return $class-&gt;new(
            height =&gt; $length,
            width  =&gt; $length,
            depth  =&gt; $length,
        );
    }

    common method inventory_count () { $num_instances }
}
</code></pre></div>

<p>But we could get rid of <code>inventory_count</code> method by supplying a reader (and
even renaming it).</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">class Box {
    my $num_instances :reader(inventory_count) = 0;      # class data!!

    slot ( $height, $width, $depth ) :param;
    slot $volume :reader = $height * $width * $depth;

    ADJUST   { $num_instances++ }
    DESTRUCT { $num_instances-- }

    common method new_cube ($length) {
        return $class-&gt;new(
            height =&gt; $length,
            width  =&gt; $length,
            depth  =&gt; $length,
        );
    }
}
</code></pre></div>

<p>So right off the bat, for new developers, we need to teach them when they can
and cannot use slot attributes with <code>my</code> variables.</p>

<p>Also, Perl has the conflation of <code>package</code> and <code>class</code>, along with <code>sub</code> and
<code>method</code>. Do want to add <code>my</code> for class data <em>and</em> for lexical variables? And
as <a href="https://github.com/Ovid/Cor/issues/35#issuecomment-900887144" target="_blank">Damian Conway has pointed
out</a> <span class="fa fa-external-link fa_custom"></span>, static
analysis tools are already hard enough to write for Perl, given the overloaded
meaning of many keywords.</p>

<p>And if we <em>do</em> accept the notion that similar things should look similar, why
would class methods and class data have different declarators? We can’t just
say <code>my method foo() {...}</code> because that clearly implies it’s a private
method.</p>

<p>Or we can adopt the approach other OO languages such as Java, C++, C#, and
Swift have done and use a single keyword to explain the same concept: these
things are bound to the class and not an instance of the class. For the
aforementioned languages, that keyword was <code>static</code>, but it was strongly shot
down as “not good for us” due to possible confusion with the <code>state</code> keyword
and the fact that different languages sometimes use <code>static</code> to mean different
things. Different things should look different.</p>

<p><code>shared</code> seems good, <a href="https://perldoc.perl.org/threads::shared" target="_blank">but that implies threads to many
people</a> <span class="fa fa-external-link fa_custom"></span>, so that was also shot down.</p>

<p>I’m not sure who came up with the word <code>common</code> (it may have been me back in
February of 2021, according to IRC logs) and so far it seems like the
least-bad alternative. (Another suggestion I proposed at that time was
<code>mutual</code>)</p>

<p>However, there are those who are <em>strongly</em> in favor of <code>my</code>, including adding
attributes to it—if it’s in Corinna and not inside a method—and strongly
object to <code>common</code> on the grounds that all methods defined in a class are
common to every instance of that class. They have a point about <code>common</code> being
a poor choice, but I don’t have a good one and I suspect that, over time, it
won’t even be noticed (I may live to regret typing that).</p>

<p>So while I’m trying to figure all of this out, <a href="http://blogs.perl.org/users/damian_conway/2021/08/a-dream-realized.html" target="_blank">Damian Conway posted an
extensive endorsement of
Corinna</a> <span class="fa fa-external-link fa_custom"></span>.
To illustrate one of his points, he shared a class written in Dios, which an
OO system for Perl which he introduced in his “Three Little Words”
presentation.</p>

<div class="video-responsive">
    <iframe width="560" height="315" src="https://www.youtube.com/embed/ob6YHpcXmTg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>

<p>He wrote the following class.</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">use Dios;

class Account {
    state $next_ID = &#39;AAA0001&#39;;

    has $.name     is rw  is required;
    has $.balance  = 0;
    has $.ID       = $next_ID++;

    method deposit ($amount) {
        $balance += $amount;
    }

    method report ($fh = *STDOUT) {
        $fh-&gt;say( &quot;$ID: $balance&quot; );
    }
}
</code></pre></div>

<p>That’s almost how you would write it in Corinna, but that’s not what I really
noticed.</p>

<p>I kept staring at that <code>state</code> variable he used to declare class data.</p>

<p>Everyone arguing for reusing an existing declarator to declare class data in
Corinna was arguing for <code>my</code>. Here’s Damian, using <code>state</code>.</p>

<p>I couldn’t get that out of my mind. And then I started thinking about inner
classes, but let’s not go there yet. Let’s talk about <code>state</code> and why this is
important.</p>

<h2><a name="state-variables"></a>State Variables</h2>

<p><a href="https://perldoc.perl.org/functions/state" target="_blank"><code>perldoc -f state</code></a> <span class="fa fa-external-link fa_custom"></span> says:</p>

<blockquote>
  <p><code>state</code> declares a lexically scoped variable, just like my. However, those
  variables will never be reinitialized, contrary to lexical variables that are
  reinitialized each time their enclosing block is entered. See <a href="https://perldoc.perl.org/perlsub#Persistent-Private-Variables" target="_blank">“Persistent
  Private Variables” in
  perlsub</a> <span class="fa fa-external-link fa_custom"></span> for
  details.</p>
</blockquote>

<p>What does that mean? Well, first, let’s run the following code.</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">sub printit {
    state $this = 1;
    my $that = 1;
    $this++;
    $that++;
    say &quot;state $this and my $that&quot;;
}
printit() for 1 .. 3;
</code></pre></div>

<p>That prints out:</p>

<pre><code>state 2 and my 2
state 3 and my 2
state 4 and my 2
</code></pre>

<p>As you can see, <code>state</code> variables are like <code>static</code> variables in C. They are
declared once and retain their value between calls. They <em>kinda</em> look like
static members in Java.</p>

<p>Let’s look at <code>state</code> some more, this time returning an anonymous subroutine
with the variables.</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">sub printit ($name) {
    return sub {
        state $this = 1;
        my $that = 1;
        $this++;
        $that++;
        say &quot;$name: state $this and my $that&quot;;
    }
}

my $first  = printit(&#39;first&#39;);
my $second = printit(&#39;second&#39;);

$first-&gt;()  for 1 .. 3;
$second-&gt;() for 1 .. 3;
</code></pre></div>

<p>And that prints out:</p>

<pre><code>first: state 2 and my 2
first: state 3 and my 2
first: state 4 and my 2
second: state 2 and my 2
second: state 3 and my 2
second: state 4 and my 2
</code></pre>

<p>Hmm, <code>perldoc -f state</code> says that <code>state</code> variables are only initialized once,
but in the case of returning an anonymous sub, we’ve created a <em>new</em> lexical
scope and we have a different state variable.</p>

<p>Just for completeness, let’s define those variables inside the outer sub, but
outside the inner sub.</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">sub printit ($name) {
    state $this = 1;
    my $that = 1;
    return sub {
        $this++;
        $that++;
        say &quot;$name: state $this and my $that&quot;;
    }
}

my $first  = printit(&#39;first&#39;);
my $second = printit(&#39;second&#39;);

$first-&gt;()  for 1 .. 3;
$second-&gt;() for 1 .. 3;
</code></pre></div>

<p>And that prints out:</p>

<pre><code>first: state 2 and my 2
first: state 3 and my 3
first: state 4 and my 4
second: state 5 and my 2
second: state 6 and my 3
second: state 7 and my 4
</code></pre>

<p>So, depending on how we declare those variables and what the enclosing scope
should be, we get different results. This is more or less as expected, though
creating a new lexical scope and having the state variables re-initialized
might surprise some because I don’t think it’s clearly documented.</p>

<p>But what does that mean for class data?</p>

<p>Part of my job is to ensure that Corinna doesn’t break existing Perl. However,
I need to ensure that Corinna doesn’t hobble future Perl, either. That’s much
harder because we can’t predict the future.</p>

<h1><a name="the-future"></a>The Future</h1>

<p>There are two things we would love to see in the future for Perl. One is inner
classes and the second is anonymous classes. “Anonymous classes” already feels
“Perlish” because  we have anonymous subroutines and most Perl developers are
familiar with the concept of closures. But let’s discuss inner classes first
since many people are not familiar with them. <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/nested.html" target="_blank">Let’s look at some examples
from the Java
documentation</a> <span class="fa fa-external-link fa_custom"></span>.</p>

<div class="shadow"><pre class="scrolled"><code class="language-java">class OuterClass {
    ...
    class InnerClass {
        ...
    }
    static class StaticNestedClass {
        ...
    }
}
</code></pre></div>

<p>The <code>InnerClass</code> has access to all static (class) and instance variables in
<code>OuterClass</code>, while the <code>StaticNestedClass</code> class only has access to the
static variables.</p>

<p>What this means is that you can put together a collection of classes and
encapsulate the “helper” classes. When people talk about allowing classes to
“trust” one another with their data but not share it with the outside world,
this is a way to do that while still maintaining encapsulation.</p>

<p>For Corinna, it might look like this:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">class OuterClass {
    ...
    class InnerClass {
        ...
    }
    common class StaticNestedClass {
        ...
    }
}
</code></pre></div>

<p>So we’d immediately have something we can reason about, with well-defined,
battle-tested semantics from the Java language (if we’re allowed to steal from
other languages, Java should be on that list. No language bigotry, please).</p>

<p>(As an aside, this is why we can’t reuse the <code>class</code> keyword for class data and
methods. How would we describe a static inner class? <code>class class
StaticNestedClass {...}</code>?)</p>

<p>Next, let’s consider an anonymous class. Here’s one way to think about it.</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">my $thing = class  {
    slot $foo;
    slot $name :param;
    ...
};
my $o1 = $thing-&gt;new(name =&gt; $name1);
my $o2 = $thing-&gt;new(name =&gt; $name2);
</code></pre></div>

<p>We could go the Java route and allow <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/anonymousclasses.html" target="_blank">declaration and instantiation at the
same
time</a> <span class="fa fa-external-link fa_custom"></span>,
but I don’t think that gains us anything:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">my $object = (class  {
    slot $foo;
    slot $name :param;
    ...
})-&gt;new(name =&gt; $name1);
</code></pre></div>

<p>But consider this:</p>

<div class="shadow"><pre class="scrolled"><code class="language-perl">class OuterClass {
    ...
    private class InnerClass {
        ...
        method some_method (%args) {
            return class {
                state $class_data = 17; # or my $class_data = 17
                slot $name :param;
            };
        }
    }
}
</code></pre></div>

<p>So we have a private inner class which returns anonymous metaclass instances
with <code>state</code> or <code>my</code> variables being used for class data. Are they shared
across all metaclass instances or not? I would think “no”, but someone else
might make a reasonable argument otherwise. And should it be <code>state</code> or <code>my</code>?
Do either really connote “global to this class regardless of how the class is
generated”?</p>

<p>And what we’re talking about is something speculative, years in the future,
where the existing semantics of <code>my</code> or <code>state</code> might be perfectly
appropriate. Or after we get there, we might discover that they’re not
appropriate and we’ve backed ourselves into a corner because we decided to
reuse a handy thing in the language.</p>

<h1><a name="conclusion"></a>Conclusion</h1>

<p>There are no good answers here, but I had to make a call. And I decided to err
on the side of established conventions in popular languages, and potential
safety for the future of Perl. I also didn’t want to potentially overload the
meaning of existing syntax.</p>

<p>There are already people who have let me know that they’re very upset with
this decision. There are others who are fine with this decision; they just
want to get Corinna in core. In this case, I don’t think there’s a “safe”
political solution. So I decided to play it safe technically.</p>

<p>People might come back to me later and make a strong argument that I screwed
up. That’s fine. I welcome those arguments and I might change my mind, but the
arguments have raged since February with no sign of consensus. I had to make a
call. I might not have made the right call, but it needed to be done.</p>

<h1><a name="update"></a>Update</h1>

<p>I’ve been getting some feedback on this. I’ve now been going back through
tickets, emails, and IRC logs and I see that there some agreement on <code>class
method foo () {...}</code>, but a lot of disagreement over <code>class $foo</code>. There was
some discussion of <code>class slot $foo</code> being OK. There has been so much
discussion of this issue for months on end, on IRC, email, and github, that
I’ve not remembered all of the fine-grained detail well.</p>

<p>The use of a <code>class</code> as a both a class declarator and a non-access modifier
overloads the meaning of <code>class</code> and violates the “different things should
look different” principle (to be fair, it’s not the only place we’ve violated
this). And this still doesn’t address the awkward case of declaring a static
inner class: <code>class class InnerClass {...}</code>.</p>

<p>Looks like this debate is not done.</p>




          <p><strong>Please leave a comment below!</strong></p>



<hr>
    <div class="prevNext">
        
        <a href="/blog/resigning-from-the-perl-foundation.html" class="prevPost">&laquo; Resigning From The Perl Foundation</a>
        
        <a href="/blog/jeff-bezos-1000-problems.html" class="nextPost">What's Wrong with Blue Origin? &raquo;</a>
    </div>

<hr>

          <p>If you'd like top-notch consulting or training, <a
          href="mailto:curtis.poe@gmail.com">email me</a> and let's discuss
          how I can help you. Read my <a href="/hireme.html">hire me</a> page
          to learn more about my background.</p>
        </div>
    </div>
<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <div class="row">
      <div class="three columns">
        <p></p>
      </div>
      <div class="nine columns">
        <hr>
        <p>Copyright &copy; 2018-2022 by Curtis “Ovid” Poe.</p>
      </div>
    </div>
        <div id="disqus_thread"></div>
    <div class="row">
      <div class="twelve columns">
      
        <script>
        var disqus_config = function () {
            this.page.url        = "https://ovid.github.io/blog/politics-in-programming.html";
            this.page.identifier = "blog/politics-in-programming";
            this.page.title      = "Politics in Programming";
        };
        (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://https-ovid-github-io.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      
        </div>
    </div>
    </div>
    
    <script src="/static/js/prism.js"></script>
    
	
</body>
</html>


